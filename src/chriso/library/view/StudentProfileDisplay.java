/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package chriso.library.view;

import chriso.library.controller.StudentDAO;
import chriso.library.model.Student;
import java.awt.Image;
import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.sql.Blob;
import java.sql.SQLException;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JOptionPane;

/**
 *
 * @author Amit
 */
public class StudentProfileDisplay extends javax.swing.JPanel {

    
    /**
     * Creates new form AddNewBookInfo
     */
    public StudentProfileDisplay() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel_component = new javax.swing.JPanel();
        jLabel_titleText = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jTextField_batch = new javax.swing.JTextField();
        jTextField_department = new javax.swing.JTextField();
        jTextField_email = new javax.swing.JTextField();
        jTextField_contact = new javax.swing.JTextField();
        jTextField_dateOfBirth = new javax.swing.JTextField();
        jLabel_dateOfBirth = new javax.swing.JLabel();
        jLabel_contact = new javax.swing.JLabel();
        jLabel_email = new javax.swing.JLabel();
        jLabel_department = new javax.swing.JLabel();
        jLabel_batch = new javax.swing.JLabel();
        jPanel_imageHolder3 = new javax.swing.JPanel();
        jLabel_forImage = new javax.swing.JLabel();
        jLabel_studentName = new javax.swing.JLabel();
        jButton_updateRecord = new javax.swing.JButton();

        setBackground(new java.awt.Color(204, 204, 204));
        addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentShown(java.awt.event.ComponentEvent evt) {
                formComponentShown(evt);
            }
        });

        jPanel_component.setBackground(new java.awt.Color(153, 153, 153));

        jLabel_titleText.setBackground(new java.awt.Color(204, 204, 204));
        jLabel_titleText.setFont(new java.awt.Font("Tahoma", 3, 36)); // NOI18N
        jLabel_titleText.setForeground(new java.awt.Color(0, 102, 102));
        jLabel_titleText.setText(StudentDAO.CURRENT_STUDENT_NAME+" Detail");
        jLabel_titleText.addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentShown(java.awt.event.ComponentEvent evt) {
                jLabel_titleTextComponentShown(evt);
            }
        });

        javax.swing.GroupLayout jPanel_componentLayout = new javax.swing.GroupLayout(jPanel_component);
        jPanel_component.setLayout(jPanel_componentLayout);
        jPanel_componentLayout.setHorizontalGroup(
            jPanel_componentLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel_componentLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel_titleText, javax.swing.GroupLayout.PREFERRED_SIZE, 531, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(60, 60, 60))
        );
        jPanel_componentLayout.setVerticalGroup(
            jPanel_componentLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel_componentLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel_titleText)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jTextField_batch.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_batchActionPerformed(evt);
            }
        });

        jTextField_department.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_departmentActionPerformed(evt);
            }
        });

        jTextField_contact.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_contactActionPerformed(evt);
            }
        });

        jTextField_dateOfBirth.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_dateOfBirthActionPerformed(evt);
            }
        });

        jLabel_dateOfBirth.setText("DOB");

        jLabel_contact.setText("Contact");

        jLabel_email.setText("Email");

        jLabel_department.setText("Department");

        jLabel_batch.setText("Batch");

        jPanel_imageHolder3.setLayout(null);
        jPanel_imageHolder3.add(jLabel_forImage);
        jLabel_forImage.setBounds(0, 6, 280, 310);

        jLabel_studentName.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel_studentName.setText("Student Name ");

        jButton_updateRecord.setText(" Update Record");
        jButton_updateRecord.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_updateRecordActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel_component, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addGap(114, 114, 114)
                .addComponent(jButton_updateRecord, javax.swing.GroupLayout.PREFERRED_SIZE, 177, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(94, 94, 94)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel_studentName, javax.swing.GroupLayout.PREFERRED_SIZE, 205, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jPanel_imageHolder3, javax.swing.GroupLayout.PREFERRED_SIZE, 281, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(83, Short.MAX_VALUE))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addContainerGap()
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                            .addGap(20, 20, 20)
                            .addComponent(jLabel_batch))
                        .addComponent(jLabel_department)
                        .addGroup(layout.createSequentialGroup()
                            .addGap(15, 15, 15)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel_contact)
                                .addComponent(jLabel_email)
                                .addComponent(jLabel_dateOfBirth))))
                    .addGap(23, 23, 23)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jTextField_dateOfBirth, javax.swing.GroupLayout.PREFERRED_SIZE, 222, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jTextField_contact, javax.swing.GroupLayout.PREFERRED_SIZE, 218, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jTextField_batch, javax.swing.GroupLayout.PREFERRED_SIZE, 222, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jTextField_email, javax.swing.GroupLayout.PREFERRED_SIZE, 222, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jTextField_department, javax.swing.GroupLayout.PREFERRED_SIZE, 222, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addContainerGap(437, Short.MAX_VALUE))
                .addComponent(jSeparator1, javax.swing.GroupLayout.Alignment.TRAILING))
        );

        layout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] {jTextField_batch, jTextField_contact, jTextField_dateOfBirth, jTextField_department, jTextField_email});

        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jPanel_component, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jPanel_imageHolder3, javax.swing.GroupLayout.PREFERRED_SIZE, 318, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jButton_updateRecord, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel_studentName)
                .addContainerGap(31, Short.MAX_VALUE))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGap(66, 66, 66)
                    .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                            .addComponent(jLabel_batch)
                            .addGap(46, 46, 46)
                            .addComponent(jLabel_department)
                            .addGap(30, 30, 30)
                            .addComponent(jLabel_email))
                        .addGroup(layout.createSequentialGroup()
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(jTextField_batch, javax.swing.GroupLayout.PREFERRED_SIZE, 32, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGap(68, 68, 68)
                                    .addComponent(jTextField_email, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGroup(layout.createSequentialGroup()
                                    .addGap(50, 50, 50)
                                    .addComponent(jTextField_department, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGap(18, 18, 18)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(jTextField_contact, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(jLabel_contact))
                            .addGap(15, 15, 15)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(jTextField_dateOfBirth, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(jLabel_dateOfBirth))))
                    .addContainerGap(150, Short.MAX_VALUE)))
        );

        layout.linkSize(javax.swing.SwingConstants.VERTICAL, new java.awt.Component[] {jTextField_batch, jTextField_contact, jTextField_dateOfBirth, jTextField_department, jTextField_email});

    }// </editor-fold>//GEN-END:initComponents

    private void jTextField_dateOfBirthActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_dateOfBirthActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_dateOfBirthActionPerformed

    private void jTextField_contactActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_contactActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_contactActionPerformed

    private void jTextField_departmentActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_departmentActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_departmentActionPerformed

    private void jTextField_batchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_batchActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_batchActionPerformed

    private void jLabel_titleTextComponentShown(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_jLabel_titleTextComponentShown
        // TODO add your handling code here:
    }//GEN-LAST:event_jLabel_titleTextComponentShown

    private void formComponentShown(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_formComponentShown
        // TODO add your handling code here:
        displayDataAutomaticallyAboutStudent();
    }//GEN-LAST:event_formComponentShown

    private void jButton_updateRecordActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_updateRecordActionPerformed
        //the task of the updating the data on request of the student is to be done
        //first get all the current data form the form
        String batch = jTextField_batch.getText();
        String department = jTextField_department.getText();
        String dob = jTextField_dateOfBirth.getText();
        String email = jTextField_email.getText();
        String contact = jTextField_contact.getText();
        //now store the data in the student object;
        Student std  = new Student();
        std.setStudentId(StudentDAO.CURRENT_STUDENT);
        std.setBatch(Integer.parseInt(batch));
        std.setContact(Long.parseLong(contact));
        std.setEmail(email);
        std.setDepartment(department);
        try{//for date then it need to be converted into the sql DAte format firstly
        DateFormat df = new SimpleDateFormat("yyyy-MM-dd");
        java.util.Date db = df.parse(dob);
        java.sql.Date sqldb = new java.sql.Date(db.getTime());
        //after this the date object will be hold in sqldb variable 
        std.setDateOfBirth(sqldb);
        }
        catch(ParseException ex){
            System.out.println("parser exception of date in the update process of student profile"+ex);
        }
        //now since all the record has been stored in the student object we 
        //now send this to the controller class to do the task of the update
        StudentDAO stddao = new StudentDAO();
        boolean success = stddao.studentUpdateHisRecord(std);
        if(success){
            JOptionPane.showMessageDialog(null,"Successfully Updated your record"); 
        }
        else{
            JOptionPane.showMessageDialog(null,"Failed to update your record \n Contact your"
                    + " Librarian. "
                    + "\nThank YOU !!! "); 
        }
        displayDataAutomaticallyAboutStudent();
    }//GEN-LAST:event_jButton_updateRecordActionPerformed
public void displayDataAutomaticallyAboutStudent(){
    Student student = new Student();
        StudentDAO stddao = new StudentDAO();
        student.setStudentId(StudentDAO.CURRENT_STUDENT);
        student= stddao.getAllStudentRecord(student);
        //after this statement the studdent object will have the entire record set 
        //the currently logged in student
        jTextField_batch.setText(""+student.getBatch());
        jTextField_department.setText(student.getDepartment());
        jTextField_dateOfBirth.setText(String.valueOf(student.getDateOfBirth()));
        jTextField_email.setText(student.getEmail());
        jTextField_contact.setText(String.valueOf(student.getContact()));
        jLabel_studentName.setText(student.getFirstName()+" "+student.getLastName());
        if(student.getStudentPhoto()==null){
          jLabel_forImage.setIcon(new ImageIcon(getClass().getResource("/Drawable/defaultProfileImage.png")));
        }
        else{
               //now preparing to display the image in the label 
               try{
                Blob blob = student.getStudentPhoto();
                int blobLength = (int)blob.length();
                byte[] bytes = blob.getBytes(1, blobLength);
               blob.free();
               BufferedImage img = ImageIO.read(new ByteArrayInputStream(bytes));
               ImageIcon icon = new ImageIcon(img);
               Image newimg=icon.getImage().getScaledInstance(192,237, BufferedImage.SCALE_DEFAULT);
               jLabel_forImage.setIcon(new ImageIcon(newimg));
               }
               catch(SQLException | IOException ex){
                   System.out.println("While displaying hte cover of book in Student SearchBOOk"+ex);
               }
        }
        System.out.println("SuccessFully displayed all the records");
}

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton_updateRecord;
    private javax.swing.JLabel jLabel_batch;
    private javax.swing.JLabel jLabel_contact;
    private javax.swing.JLabel jLabel_dateOfBirth;
    private javax.swing.JLabel jLabel_department;
    private javax.swing.JLabel jLabel_email;
    private javax.swing.JLabel jLabel_forImage;
    private javax.swing.JLabel jLabel_studentName;
    private javax.swing.JLabel jLabel_titleText;
    private javax.swing.JPanel jPanel_component;
    private javax.swing.JPanel jPanel_imageHolder3;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JTextField jTextField_batch;
    private javax.swing.JTextField jTextField_contact;
    private javax.swing.JTextField jTextField_dateOfBirth;
    private javax.swing.JTextField jTextField_department;
    private javax.swing.JTextField jTextField_email;
    // End of variables declaration//GEN-END:variables
}
