/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package chriso.library.view;

import chriso.library.controller.BookDAO;
import chriso.library.miscelleneous.ErrorOutputHolder;
import chriso.library.miscelleneous.InputController;
import chriso.library.model.Book;
import chriso.library.model.LocalBookEntry;
import java.awt.FileDialog;
import java.awt.Image;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.File;
import java.sql.Blob;
import java.util.ArrayList;
import java.util.List;
import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.Timer;

/**
 *
 * @author Amit
 */
public class SearchAndUpdateBook extends javax.swing.JPanel {

    String search = "";
    long track_old_isbn;
    int localcodefrom, localcodeto ; //these variable is to keep the track of the book code used for the update process 

    /**
     * Creates new form AddNewBookInfo
     */
    public SearchAndUpdateBook() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jTextField_codeNo = new javax.swing.JTextField();
        jTextField_title = new javax.swing.JTextField();
        jTextField_author = new javax.swing.JTextField();
        jTextField_shelf = new javax.swing.JTextField();
        jTextField_column = new javax.swing.JTextField();
        jTextField_row = new javax.swing.JTextField();
        jButton_updateRecord = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        jLabel_cover = new javax.swing.JLabel();
        jButton_changeCover = new javax.swing.JButton();
        jTextField_searchInput = new javax.swing.JTextField();
        jLabel9 = new javax.swing.JLabel();
        jTextField_isbn = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        jTextField_stockAvailable = new javax.swing.JTextField();
        jLabel11 = new javax.swing.JLabel();
        jComboBox_bookStatus = new javax.swing.JComboBox();
        jLabel_errorMsg = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jTextField_bookCoverURL = new javax.swing.JTextField();

        setBackground(new java.awt.Color(204, 204, 204));

        jLabel1.setText("Code no.");

        jLabel2.setText("Title");

        jLabel3.setText("Author");

        jLabel4.setText("Book shelf");

        jLabel5.setText("column");

        jLabel6.setText("Row");

        jTextField_codeNo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_codeNoActionPerformed(evt);
            }
        });
        jTextField_codeNo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTextField_codeNoKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextField_codeNoKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_codeNoKeyTyped(evt);
            }
        });

        jTextField_title.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_titleActionPerformed(evt);
            }
        });

        jTextField_author.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_authorActionPerformed(evt);
            }
        });

        jTextField_shelf.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_shelfActionPerformed(evt);
            }
        });

        jTextField_column.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_columnActionPerformed(evt);
            }
        });

        jTextField_row.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_rowActionPerformed(evt);
            }
        });

        jButton_updateRecord.setBackground(new java.awt.Color(0, 102, 102));
        jButton_updateRecord.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jButton_updateRecord.setForeground(new java.awt.Color(51, 51, 51));
        jButton_updateRecord.setText(" Update Record");
        jButton_updateRecord.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_updateRecordActionPerformed(evt);
            }
        });

        jPanel1.setBackground(new java.awt.Color(153, 153, 153));

        jLabel7.setBackground(new java.awt.Color(204, 204, 204));
        jLabel7.setFont(new java.awt.Font("Tahoma", 3, 36)); // NOI18N
        jLabel7.setForeground(new java.awt.Color(0, 102, 102));
        jLabel7.setText("Search and update Book Detail");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(36, 36, 36)
                .addComponent(jLabel7, javax.swing.GroupLayout.PREFERRED_SIZE, 582, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(42, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap(16, Short.MAX_VALUE)
                .addComponent(jLabel7)
                .addContainerGap())
        );

        jLabel8.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel8.setText("Search By Book code: ");

        jPanel2.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());
        jPanel2.add(jLabel_cover, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 130, 160));

        jButton_changeCover.setText("Change Cover");
        jButton_changeCover.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_changeCoverActionPerformed(evt);
            }
        });

        jTextField_searchInput.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTextField_searchInputKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextField_searchInputKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_searchInputKeyTyped(evt);
            }
        });

        jLabel9.setText("ISBN");

        jLabel10.setText("Stock Available");

        jTextField_stockAvailable.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_stockAvailableActionPerformed(evt);
            }
        });
        jTextField_stockAvailable.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTextField_stockAvailableKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextField_stockAvailableKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_stockAvailableKeyTyped(evt);
            }
        });

        jLabel11.setText("Status");

        jComboBox_bookStatus.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "OUT", "IN", "LOST" }));
        jComboBox_bookStatus.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox_bookStatusActionPerformed(evt);
            }
        });

        jLabel_errorMsg.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel_errorMsg.setForeground(new java.awt.Color(255, 0, 0));

        jTextField_bookCoverURL.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextField_bookCoverURLKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_bookCoverURLKeyTyped(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 660, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGroup(layout.createSequentialGroup()
                .addGap(92, 92, 92)
                .addComponent(jLabel8, javax.swing.GroupLayout.PREFERRED_SIZE, 210, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(16, 16, 16)
                .addComponent(jTextField_searchInput, javax.swing.GroupLayout.PREFERRED_SIZE, 192, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel_errorMsg, javax.swing.GroupLayout.PREFERRED_SIZE, 140, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGroup(layout.createSequentialGroup()
                .addGap(30, 30, 30)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel1)
                    .addComponent(jLabel9)
                    .addComponent(jLabel3)
                    .addComponent(jLabel2))
                .addGap(16, 16, 16)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(4, 4, 4)
                        .addComponent(jTextField_codeNo, javax.swing.GroupLayout.PREFERRED_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jLabel11)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jComboBox_bookStatus, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jTextField_isbn, javax.swing.GroupLayout.PREFERRED_SIZE, 220, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTextField_author, javax.swing.GroupLayout.PREFERRED_SIZE, 222, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTextField_title, javax.swing.GroupLayout.PREFERRED_SIZE, 222, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(48, 48, 48)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, 134, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jButton_changeCover))
                    .addComponent(jTextField_bookCoverURL, javax.swing.GroupLayout.PREFERRED_SIZE, 260, javax.swing.GroupLayout.PREFERRED_SIZE)))
            .addGroup(layout.createSequentialGroup()
                .addGap(10, 10, 10)
                .addComponent(jLabel10)
                .addGap(8, 8, 8)
                .addComponent(jTextField_stockAvailable, javax.swing.GroupLayout.PREFERRED_SIZE, 222, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(48, 48, 48)
                .addComponent(jLabel4)
                .addGap(11, 11, 11)
                .addComponent(jTextField_shelf, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(10, 10, 10)
                .addComponent(jLabel5)
                .addGap(7, 7, 7)
                .addComponent(jTextField_column, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(10, 10, 10)
                .addComponent(jLabel6, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(jTextField_row, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGroup(layout.createSequentialGroup()
                .addGap(240, 240, 240)
                .addComponent(jButton_updateRecord, javax.swing.GroupLayout.PREFERRED_SIZE, 142, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(1, 1, 1)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(22, 22, 22)
                        .addComponent(jLabel_errorMsg, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel8, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(3, 3, 3)
                                .addComponent(jTextField_searchInput, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(36, 36, 36)
                        .addComponent(jLabel1)
                        .addGap(26, 26, 26)
                        .addComponent(jLabel9)
                        .addGap(26, 26, 26)
                        .addComponent(jLabel3)
                        .addGap(26, 26, 26)
                        .addComponent(jLabel2))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(27, 27, 27)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jTextField_codeNo, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(jComboBox_bookStatus, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel11))
                                .addGap(6, 6, 6)))
                        .addGap(9, 9, 9)
                        .addComponent(jTextField_isbn, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(10, 10, 10)
                        .addComponent(jTextField_author, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(10, 10, 10)
                        .addComponent(jTextField_title, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(89, 89, 89)
                                .addComponent(jButton_changeCover))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(2, 2, 2)
                                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, 162, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jTextField_bookCoverURL, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(jLabel10))
                    .addComponent(jTextField_stockAvailable, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(20, 20, 20)
                        .addComponent(jLabel4))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(jTextField_shelf, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(20, 20, 20)
                        .addComponent(jLabel5))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(jTextField_column, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(20, 20, 20)
                        .addComponent(jLabel6))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(jTextField_row, javax.swing.GroupLayout.PREFERRED_SIZE, 38, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addComponent(jButton_updateRecord, javax.swing.GroupLayout.PREFERRED_SIZE, 54, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void jTextField_shelfActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_shelfActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_shelfActionPerformed

    private void jTextField_columnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_columnActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_columnActionPerformed

    private void jTextField_titleActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_titleActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_titleActionPerformed

    private void jTextField_authorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_authorActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_authorActionPerformed

    private void jTextField_codeNoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_codeNoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_codeNoActionPerformed

    private void jTextField_stockAvailableActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_stockAvailableActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_stockAvailableActionPerformed

    private void jButton_updateRecordActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_updateRecordActionPerformed
        //firstly extract the value from the text field
        try{
        long isbn = Long.parseLong(jTextField_isbn.getText());
        String bookStatus = jComboBox_bookStatus.getSelectedItem().toString();
        String title = jTextField_title.getText();
        String author = jTextField_author.getText();
        String status = jComboBox_bookStatus.getSelectedItem().toString();
        int stock = Integer.parseInt(jTextField_stockAvailable.getText());
        String coverUrl = jTextField_bookCoverURL.getText();
        int bookShelf = Integer.parseInt(jTextField_shelf.getText());
        int col = Integer.parseInt(jTextField_column.getText());
        int row = Integer.parseInt(jTextField_row.getText());
        int oldCode = Integer.parseInt(jTextField_searchInput.getText());
        int newCode = Integer.parseInt(jTextField_codeNo.getText());
        
        if(isbn>0 && oldCode!=0&& newCode!=0 && (!title.equals("")) && (!author.equals("")) 
           && (!status.equals("")) && (!coverUrl.equals("")) && bookShelf>=0 && col>=0 && row>=0){    
        //now we will create the object of the book and store all the above information
        Book newBook = new Book();
        
        newBook.setNewIsbn(isbn);
        newBook.setIsbn(track_old_isbn);
        newBook.setBookTitle(title);
        newBook.setBookAuthor(author);
        newBook.setBookShelf(bookShelf);
        newBook.setCol(col);
        newBook.setRow(row);
        newBook.setStockAvailable(stock);
        newBook.setLocalCodeFrom(localcodefrom);
        newBook.setLocalCodeTo(localcodeto);
        
        if(!coverUrl.equals("")){ //this value will be added to the object only 
            //when the value will be available
        newBook.setBookURL(coverUrl);
                }//end of the if 
        
        //now preparring the data for the insertion in the child Table LocalBookEntry
        LocalBookEntry lbe = new LocalBookEntry();
        lbe.setIsbn(isbn);
        lbe.setBookStatus(status);
        lbe.setBookCode(newCode);
        lbe.setOldBookCode(oldCode);
        lbe.setBookStatus(bookStatus);

        //now submit the above object data to the book DAO class for insertion
        BookDAO bd = new BookDAO();
        boolean success = bd.updateBookRecord(newBook, lbe);
        if (success) {
            JOptionPane.showMessageDialog(null, "Book Record Updated");
             displayRecordSearched(search);
        } else {
            JOptionPane.showMessageDialog(null, "Book updating failed"+ErrorOutputHolder.updateBookErrorText);
            System.out.println("error in the code for updating the book");
        }
        }//end of if cheching the value availability for the update
        else{
                      JOptionPane.showMessageDialog(null, "All Fied are Required with valid input including the searchInput code");
           }
        }//end of the try block 
        catch(Exception ex){
                      JOptionPane.showMessageDialog(null, "All Fied are Required with valid input including the searchInput code");
            
        }
    }//GEN-LAST:event_jButton_updateRecordActionPerformed

    private void jTextField_rowActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_rowActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_rowActionPerformed

    private void jTextField_searchInputKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_searchInputKeyTyped
        // TODO add your handling code here:
//        char c = (char) evt.getKeyChar();
//        if (!InputController.allowOnlyNumber(evt, c)) {
//            return; //meaning the input provided is other than the number so 
//            //not required to execute code further;
//        }
//
//        search += c;
        

    }//GEN-LAST:event_jTextField_searchInputKeyTyped

    public void displayRecordSearched(String search){
        BookDAO bookdao = new BookDAO();
        Book book = new Book();
        book.setBookCode(Integer.parseInt(search));
        book = bookdao.getSearchResultAndUpdate(book);
        if (book.getBookTitle() != null) {
            jLabel_errorMsg.setIcon(new ImageIcon(getClass().getResource("/Drawable/ok.jpg")));
            jLabel_errorMsg.setText("");

            jTextField_codeNo.setText("" + book.getBookCode());
            jTextField_isbn.setText("" + book.getIsbn());
            track_old_isbn = book.getIsbn();//to keep teh previous isbn no stored
            jTextField_title.setText(book.getBookTitle());
            jTextField_author.setText(book.getBookAuthor());
            jTextField_stockAvailable.setText("" + book.getStockAvailable());
            jTextField_column.setText(String.valueOf(book.getCol()));
            jTextField_row.setText(String.valueOf(book.getRow()));
            jTextField_shelf.setText(String.valueOf(book.getBookShelf()));
            jComboBox_bookStatus.setSelectedItem(book.getBookStatus());

            //also we need to set the variabale for the local code from/to used during the update process
            localcodefrom = book.getLocalCodeFrom();
            localcodeto = book.getLocalCodeTo();
            //now preparing to display image from the database
            if (book.getBookCover() == null) {
                jLabel_cover.setText("");
                jLabel_cover.setIcon(new ImageIcon(getClass().getResource("/Drawable/notAvailable.jpg")));
            } else {
                try {
                    Blob blob = book.getBookCover();
                    int blobLength = (int) blob.length();
                    byte[] bytes = blob.getBytes(1, blobLength);
                    blob.free();
                    BufferedImage img = ImageIO.read(new ByteArrayInputStream(bytes));
                    ImageIcon icon = new ImageIcon(img);
                    Image newimg = icon.getImage().getScaledInstance(130, 160, BufferedImage.SCALE_DEFAULT);

                    jLabel_cover.setIcon(new ImageIcon(newimg));
                    System.out.println("Successfully displayed the image in the label book Cover");

                } catch (Exception ex) {
                    System.out.println("from the book cover page fetching task" + ex);
                }
            }

            
            System.out.println("successfully displayed the searched item value in their respective field");
        }//when the book search code is not found 
        else {
            jLabel_errorMsg.setIcon(null);
            jLabel_errorMsg.setText("No match found for this Book Code");
            //the statement below is used for dispallaying the error message 
            //upto the 3 seconds 
            Timer timer = new Timer(3000,new ActionListener(){
            public void actionPerformed(ActionEvent e){
                jLabel_errorMsg.setText("");
            }});
            timer.start(); //starting the timer 
        }//end of else when the book title is not shown for no matched found
    }
    private void jTextField_searchInputKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_searchInputKeyPressed
        // TODO add your handling code her
    }//GEN-LAST:event_jTextField_searchInputKeyPressed

    private void jTextField_searchInputKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_searchInputKeyReleased
        // TODO add your handling code here:
        char c = (char) evt.getKeyChar();
        if (InputController.allowOnlyWord(evt, c)) {
            jLabel_errorMsg.setText("only number are allowed");
        } else {
            jLabel_errorMsg.setText("");
            search = jTextField_searchInput.getText();
        }
if((search).equals("")){
    
}else{
        displayRecordSearched(search);
}
    }//GEN-LAST:event_jTextField_searchInputKeyReleased

    private void jButton_changeCoverActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_changeCoverActionPerformed
        JFileChooser jfc = new JFileChooser();
        int result = jfc.showOpenDialog(this);
        if (result == JFileChooser.APPROVE_OPTION) {
            File file = jfc.getSelectedFile();
            jTextField_bookCoverURL.setText(file.toString());
        } else {
            jTextField_bookCoverURL.setText("choose the image to change");
        }
    }//GEN-LAST:event_jButton_changeCoverActionPerformed

    private void jComboBox_bookStatusActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBox_bookStatusActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jComboBox_bookStatusActionPerformed

    private void jTextField_bookCoverURLKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_bookCoverURLKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_bookCoverURLKeyTyped

    private void jTextField_bookCoverURLKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_bookCoverURLKeyReleased
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_bookCoverURLKeyReleased

    private void jTextField_stockAvailableKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_stockAvailableKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_stockAvailableKeyTyped

    private void jTextField_stockAvailableKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_stockAvailableKeyReleased
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_stockAvailableKeyReleased

    private void jTextField_stockAvailableKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_stockAvailableKeyPressed
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_stockAvailableKeyPressed

    private void jTextField_codeNoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_codeNoKeyPressed
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_codeNoKeyPressed

    private void jTextField_codeNoKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_codeNoKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_codeNoKeyTyped

    private void jTextField_codeNoKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_codeNoKeyReleased
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_codeNoKeyReleased


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton_changeCover;
    private javax.swing.JButton jButton_updateRecord;
    private javax.swing.JComboBox jComboBox_bookStatus;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JLabel jLabel_cover;
    private javax.swing.JLabel jLabel_errorMsg;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JTextField jTextField_author;
    private javax.swing.JTextField jTextField_bookCoverURL;
    private javax.swing.JTextField jTextField_codeNo;
    private javax.swing.JTextField jTextField_column;
    private javax.swing.JTextField jTextField_isbn;
    private javax.swing.JTextField jTextField_row;
    private javax.swing.JTextField jTextField_searchInput;
    private javax.swing.JTextField jTextField_shelf;
    private javax.swing.JTextField jTextField_stockAvailable;
    private javax.swing.JTextField jTextField_title;
    // End of variables declaration//GEN-END:variables
}
