/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package chriso.library.view;

import chriso.library.controller.BookDAO;
import chriso.library.miscelleneous.InputController;
import chriso.library.model.Book;
import java.awt.Image;
import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.sql.Blob;
import java.sql.SQLException;
import javax.imageio.ImageIO;
import javax.swing.ImageIcon;

/**
 *
 * @author Amit
 */
public class StudentSearchBook extends javax.swing.JPanel {

    String search ="";
    private int KEY_GIVEN = -1;
    /**
     * Creates new form AddNewBookInfo
     */
    public StudentSearchBook() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        matteBorder1 = new javax.swing.border.MatteBorder(null);
        filler1 = new javax.swing.Box.Filler(new java.awt.Dimension(0, 0), new java.awt.Dimension(0, 0), new java.awt.Dimension(32767, 32767));
        jLabel_isbn = new javax.swing.JLabel();
        jLabel_bookTitle = new javax.swing.JLabel();
        jLabel_author = new javax.swing.JLabel();
        jLabel_bookShelf = new javax.swing.JLabel();
        jLabel_row = new javax.swing.JLabel();
        jLabel_column = new javax.swing.JLabel();
        jTextField_isbn = new javax.swing.JTextField();
        jTextField_bookTitle = new javax.swing.JTextField();
        jTextField_bookAuthor = new javax.swing.JTextField();
        jTextField_bookShelf = new javax.swing.JTextField();
        jTextField_row = new javax.swing.JTextField();
        jTextField_column = new javax.swing.JTextField();
        jPanel_titleHolder = new javax.swing.JPanel();
        jLabel_title = new javax.swing.JLabel();
        jLabel_searchBoardText = new javax.swing.JLabel();
        BookCover = new javax.swing.JPanel();
        jLabel_bookCover = new javax.swing.JLabel();
        jTextField_searchInput = new javax.swing.JTextField();
        jLabel_stockAvailable = new javax.swing.JLabel();
        jTextField_stockAvailable = new javax.swing.JTextField();
        jLabel_errorMsg = new javax.swing.JLabel();
        jComboBox_bookStatus = new javax.swing.JComboBox();
        jLabel_status = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jSeparator2 = new javax.swing.JSeparator();

        setBackground(new java.awt.Color(204, 204, 204));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel_isbn.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel_isbn.setText("ISBN no.");
        add(jLabel_isbn, new org.netbeans.lib.awtextra.AbsoluteConstraints(6, 162, -1, -1));

        jLabel_bookTitle.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel_bookTitle.setText("Title");
        add(jLabel_bookTitle, new org.netbeans.lib.awtextra.AbsoluteConstraints(6, 286, -1, -1));

        jLabel_author.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel_author.setText("Author");
        add(jLabel_author, new org.netbeans.lib.awtextra.AbsoluteConstraints(6, 228, -1, -1));

        jLabel_bookShelf.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel_bookShelf.setText("Book shelf");
        add(jLabel_bookShelf, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 402, -1, -1));

        jLabel_row.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel_row.setText("Row");
        add(jLabel_row, new org.netbeans.lib.awtextra.AbsoluteConstraints(126, 402, -1, -1));

        jLabel_column.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel_column.setText("Column");
        add(jLabel_column, new org.netbeans.lib.awtextra.AbsoluteConstraints(214, 402, -1, -1));

        jTextField_isbn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_isbnActionPerformed(evt);
            }
        });
        jTextField_isbn.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_isbnKeyTyped(evt);
            }
        });
        add(jTextField_isbn, new org.netbeans.lib.awtextra.AbsoluteConstraints(79, 149, 222, 41));

        jTextField_bookTitle.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_bookTitleActionPerformed(evt);
            }
        });
        jTextField_bookTitle.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_bookTitleKeyTyped(evt);
            }
        });
        add(jTextField_bookTitle, new org.netbeans.lib.awtextra.AbsoluteConstraints(76, 276, 222, 41));

        jTextField_bookAuthor.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_bookAuthorActionPerformed(evt);
            }
        });
        jTextField_bookAuthor.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_bookAuthorKeyTyped(evt);
            }
        });
        add(jTextField_bookAuthor, new org.netbeans.lib.awtextra.AbsoluteConstraints(79, 215, 222, 41));

        jTextField_bookShelf.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_bookShelfActionPerformed(evt);
            }
        });
        jTextField_bookShelf.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_bookShelfKeyTyped(evt);
            }
        });
        add(jTextField_bookShelf, new org.netbeans.lib.awtextra.AbsoluteConstraints(67, 389, 55, 41));

        jTextField_row.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_rowActionPerformed(evt);
            }
        });
        jTextField_row.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_rowKeyTyped(evt);
            }
        });
        add(jTextField_row, new org.netbeans.lib.awtextra.AbsoluteConstraints(155, 390, 55, 39));

        jTextField_column.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_columnKeyTyped(evt);
            }
        });
        add(jTextField_column, new org.netbeans.lib.awtextra.AbsoluteConstraints(265, 390, 55, 38));

        jPanel_titleHolder.setBackground(new java.awt.Color(153, 153, 153));
        jPanel_titleHolder.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1));

        jLabel_title.setBackground(new java.awt.Color(204, 204, 204));
        jLabel_title.setFont(new java.awt.Font("Tahoma", 3, 36)); // NOI18N
        jLabel_title.setForeground(new java.awt.Color(0, 102, 102));
        jLabel_title.setText("Search  Book Detail");

        javax.swing.GroupLayout jPanel_titleHolderLayout = new javax.swing.GroupLayout(jPanel_titleHolder);
        jPanel_titleHolder.setLayout(jPanel_titleHolderLayout);
        jPanel_titleHolderLayout.setHorizontalGroup(
            jPanel_titleHolderLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel_titleHolderLayout.createSequentialGroup()
                .addGap(91, 91, 91)
                .addComponent(jLabel_title, javax.swing.GroupLayout.PREFERRED_SIZE, 368, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(109, Short.MAX_VALUE))
        );
        jPanel_titleHolderLayout.setVerticalGroup(
            jPanel_titleHolderLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel_titleHolderLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel_title)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        add(jPanel_titleHolder, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 570, 60));

        jLabel_searchBoardText.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel_searchBoardText.setText("Search By BookCode:");
        add(jLabel_searchBoardText, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 90, 200, 39));

        BookCover.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        javax.swing.GroupLayout BookCoverLayout = new javax.swing.GroupLayout(BookCover);
        BookCover.setLayout(BookCoverLayout);
        BookCoverLayout.setHorizontalGroup(
            BookCoverLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLabel_bookCover, javax.swing.GroupLayout.DEFAULT_SIZE, 192, Short.MAX_VALUE)
        );
        BookCoverLayout.setVerticalGroup(
            BookCoverLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLabel_bookCover, javax.swing.GroupLayout.DEFAULT_SIZE, 237, Short.MAX_VALUE)
        );

        add(BookCover, new org.netbeans.lib.awtextra.AbsoluteConstraints(345, 148, -1, 241));

        jTextField_searchInput.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_searchInputActionPerformed(evt);
            }
        });
        jTextField_searchInput.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextField_searchInputKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_searchInputKeyTyped(evt);
            }
        });
        add(jTextField_searchInput, new org.netbeans.lib.awtextra.AbsoluteConstraints(210, 90, 187, 39));

        jLabel_stockAvailable.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel_stockAvailable.setText("Stock Available");
        add(jLabel_stockAvailable, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 460, 81, -1));

        jTextField_stockAvailable.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField_stockAvailableKeyTyped(evt);
            }
        });
        add(jTextField_stockAvailable, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 450, 70, 38));

        jLabel_errorMsg.setForeground(new java.awt.Color(255, 0, 0));
        add(jLabel_errorMsg, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 100, 159, 25));

        jComboBox_bookStatus.setModel(new javax.swing.DefaultComboBoxModel(new String[] {"IN", "OUT", "LOST" }));
        add(jComboBox_bookStatus, new org.netbeans.lib.awtextra.AbsoluteConstraints(80, 330, 90, 30));

        jLabel_status.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        jLabel_status.setText("Status");
        add(jLabel_status, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 340, -1, -1));

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        jLabel1.setText("Book Cover Image");
        add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(390, 390, 120, 20));
        add(jSeparator2, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 62, 570, 10));
    }// </editor-fold>//GEN-END:initComponents

    private void jTextField_bookShelfActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_bookShelfActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_bookShelfActionPerformed

    private void jTextField_rowActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_rowActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_rowActionPerformed

    private void jTextField_bookTitleActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_bookTitleActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_bookTitleActionPerformed

    private void jTextField_bookAuthorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_bookAuthorActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_bookAuthorActionPerformed

    private void jTextField_isbnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_isbnActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_isbnActionPerformed

    private void jTextField_searchInputActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_searchInputActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_searchInputActionPerformed

    private void jTextField_searchInputKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_searchInputKeyTyped
         // TODO add your handling code here: 
         char c  = (char)evt.getKeyChar();
        if(!InputController.allowOnlyNumber(evt, c)){
            KEY_GIVEN = -1;
            return; //meaning the input provided is other than the number so 
            //not required to execute code further;
        }
        else{
            KEY_GIVEN = 1;
        }
    }//GEN-LAST:event_jTextField_searchInputKeyTyped
    public void clearAllTextField(){
    jTextField_bookAuthor.setText("");
    jTextField_bookShelf.setText("");
    jTextField_bookTitle.setText("");
    jTextField_column.setText("");
    jTextField_isbn.setText("");
    jTextField_row.setText("");
    jTextField_stockAvailable.setText("");
    jLabel_bookCover.setIcon(null);
    }
    
    private void jTextField_isbnKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_isbnKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_isbnKeyTyped

    private void jTextField_bookAuthorKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_bookAuthorKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_bookAuthorKeyTyped

    private void jTextField_bookTitleKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_bookTitleKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_bookTitleKeyTyped

    private void jTextField_bookShelfKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_bookShelfKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_bookShelfKeyTyped

    private void jTextField_rowKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_rowKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_rowKeyTyped

    private void jTextField_columnKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_columnKeyTyped
        // TODO add your handling code here:
        evt.consume();
    }//GEN-LAST:event_jTextField_columnKeyTyped

    private void jTextField_stockAvailableKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_stockAvailableKeyTyped
        // TODO add your handling code here
        evt.consume();
    }//GEN-LAST:event_jTextField_stockAvailableKeyTyped

    private void jTextField_searchInputKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField_searchInputKeyReleased
        // TODO add your handling code here:
        search = jTextField_searchInput.getText();
        if(KEY_GIVEN==-1 && search.equals("")){
           System.out.println("returning due to key given is -1");
            return;
        }
            
        
        BookDAO bookdao = new BookDAO();
        Book book = new Book();
        book.setBookCode(Integer.parseInt(search));
        book = bookdao.getSearchResultAndUpdate(book);
        if(book.getBookTitle()!=null){
            jLabel_errorMsg.setIcon(new ImageIcon(getClass().getResource("/Drawable/ok.jpg")));
            jLabel_errorMsg.setText("");
            
            jTextField_isbn.setText(""+book.getIsbn());
            jTextField_bookTitle.setText(book.getBookTitle());
            jTextField_bookAuthor.setText(book.getBookAuthor());
            jTextField_stockAvailable.setText(""+book.getStockAvailable());
            jTextField_column.setText(String.valueOf(book.getCol()));
            jTextField_row.setText(String.valueOf(book.getRow()));
            jTextField_bookShelf.setText(String.valueOf(book.getBookShelf()));
            jComboBox_bookStatus.setSelectedItem(book.getBookStatus());
            if(book.getBookCover()==null){
                jLabel_bookCover.setIcon(new ImageIcon(getClass().getResource("/Drawable/notAvailable.jpg")));
            }
            else{
                //now preparing to display the image in the label 
               try{
                Blob blob = book.getBookCover();
                int blobLength = (int)blob.length();
                byte[] bytes = blob.getBytes(1, blobLength);
               blob.free();
               BufferedImage img = ImageIO.read(new ByteArrayInputStream(bytes));
               ImageIcon icon = new ImageIcon(img);
               Image newimg=icon.getImage().getScaledInstance(192,237, BufferedImage.SCALE_DEFAULT);
               jLabel_bookCover.setIcon(new ImageIcon(newimg));
               }
               catch(SQLException | IOException ex){
                   System.out.println("While displaying hte cover of book in Student SearchBOOk"+ex);
               }
            }
             jLabel_errorMsg.setText("Book Found....");
            System.out.println("successfully displayed the searched item value in their respective field");
        }
        else{
            jLabel_errorMsg.setIcon(null);
            jLabel_errorMsg.setText("No match found for this Book Code");
            clearAllTextField();
        }
        
    }//GEN-LAST:event_jTextField_searchInputKeyReleased

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel BookCover;
    private javax.swing.Box.Filler filler1;
    private javax.swing.JComboBox jComboBox_bookStatus;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel_author;
    private javax.swing.JLabel jLabel_bookCover;
    private javax.swing.JLabel jLabel_bookShelf;
    private javax.swing.JLabel jLabel_bookTitle;
    private javax.swing.JLabel jLabel_column;
    private javax.swing.JLabel jLabel_errorMsg;
    private javax.swing.JLabel jLabel_isbn;
    private javax.swing.JLabel jLabel_row;
    private javax.swing.JLabel jLabel_searchBoardText;
    private javax.swing.JLabel jLabel_status;
    private javax.swing.JLabel jLabel_stockAvailable;
    private javax.swing.JLabel jLabel_title;
    private javax.swing.JPanel jPanel_titleHolder;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JTextField jTextField_bookAuthor;
    private javax.swing.JTextField jTextField_bookShelf;
    private javax.swing.JTextField jTextField_bookTitle;
    private javax.swing.JTextField jTextField_column;
    private javax.swing.JTextField jTextField_isbn;
    private javax.swing.JTextField jTextField_row;
    private javax.swing.JTextField jTextField_searchInput;
    private javax.swing.JTextField jTextField_stockAvailable;
    private javax.swing.border.MatteBorder matteBorder1;
    // End of variables declaration//GEN-END:variables
}
