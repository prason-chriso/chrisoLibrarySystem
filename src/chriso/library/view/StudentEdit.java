/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package chriso.library.view;

import chriso.library.controller.StudentDAO;
import chriso.library.model.Student;
import javax.swing.ImageIcon;
import javax.swing.JOptionPane;

/**
 *
 * @author Amit
 */
public class StudentEdit extends javax.swing.JPanel {

    /**
     * Creates new form EditAdminPassword
     */
    private boolean ALL_CORRECT_INPUT=false;
    public StudentEdit() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel_title = new javax.swing.JLabel();
        jPasswordField_currentPass = new javax.swing.JPasswordField();
        jPasswordField_newPass = new javax.swing.JPasswordField();
        jPasswordField_reTypeNewPass = new javax.swing.JPasswordField();
        jLabel_currentPass = new javax.swing.JLabel();
        jLabel_newPass = new javax.swing.JLabel();
        jLabel_reTypeNewPass = new javax.swing.JLabel();
        jButton_updatePassword = new javax.swing.JButton();
        jLabel_userName = new javax.swing.JLabel();
        jTextField_userName = new javax.swing.JTextField();
        jLabel_errorReTypePass = new javax.swing.JLabel();
        jLabel_errorUsername = new javax.swing.JLabel();
        jLabel_errorCurrentPass = new javax.swing.JLabel();
        jLabel_errorNewPass = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();

        setBackground(new java.awt.Color(204, 204, 204));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel1.setBackground(new java.awt.Color(153, 153, 153));

        jLabel_title.setFont(new java.awt.Font("Tahoma", 1, 30)); // NOI18N
        jLabel_title.setForeground(new java.awt.Color(153, 0, 0));
        jLabel_title.setText("Update Username and  Password");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(137, 137, 137)
                .addComponent(jLabel_title, javax.swing.GroupLayout.PREFERRED_SIZE, 514, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(189, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel_title, javax.swing.GroupLayout.PREFERRED_SIZE, 58, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 840, 70));

        jPasswordField_currentPass.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                jPasswordField_currentPassFocusLost(evt);
            }
        });
        add(jPasswordField_currentPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 210, 179, 30));
        add(jPasswordField_newPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(530, 140, 170, 30));

        jPasswordField_reTypeNewPass.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jPasswordField_reTypeNewPassActionPerformed(evt);
            }
        });
        jPasswordField_reTypeNewPass.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jPasswordField_reTypeNewPassKeyTyped(evt);
            }
        });
        add(jPasswordField_reTypeNewPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(530, 210, 170, 30));

        jLabel_currentPass.setText("Current Password");
        add(jLabel_currentPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 220, -1, -1));

        jLabel_newPass.setText("New Password");
        add(jLabel_newPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(440, 150, -1, 20));

        jLabel_reTypeNewPass.setText("Retype Password");
        add(jLabel_reTypeNewPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(440, 220, -1, 20));

        jButton_updatePassword.setBackground(new java.awt.Color(0, 102, 102));
        jButton_updatePassword.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jButton_updatePassword.setText("Update Record");
        jButton_updatePassword.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_updatePasswordActionPerformed(evt);
            }
        });
        add(jButton_updatePassword, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 280, 190, 50));

        jLabel_userName.setText("User Name ");
        add(jLabel_userName, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 150, -1, -1));

        jTextField_userName.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jTextField_userNameFocusGained(evt);
            }
        });
        add(jTextField_userName, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 140, 182, 27));

        jLabel_errorReTypePass.setForeground(new java.awt.Color(255, 0, 0));
        add(jLabel_errorReTypePass, new org.netbeans.lib.awtextra.AbsoluteConstraints(700, 210, 120, 30));

        jLabel_errorUsername.setForeground(new java.awt.Color(255, 0, 0));
        add(jLabel_errorUsername, new org.netbeans.lib.awtextra.AbsoluteConstraints(300, 140, 130, 30));

        jLabel_errorCurrentPass.setForeground(new java.awt.Color(255, 0, 0));
        add(jLabel_errorCurrentPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(300, 210, 130, 30));

        jLabel_errorNewPass.setForeground(new java.awt.Color(255, 0, 0));
        add(jLabel_errorNewPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(700, 140, 120, 30));
        add(jSeparator1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 70, 840, 10));
    }// </editor-fold>//GEN-END:initComponents

    private void jPasswordField_reTypeNewPassActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jPasswordField_reTypeNewPassActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jPasswordField_reTypeNewPassActionPerformed

    private void jPasswordField_reTypeNewPassKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jPasswordField_reTypeNewPassKeyTyped
      String newPass = new String (jPasswordField_newPass.getPassword());
      String re = new String (jPasswordField_reTypeNewPass.getPassword());
      String reType= re+(char)evt.getKeyChar();
      
      if(reType.equals(newPass)){
          jLabel_errorReTypePass.setText("");
          jLabel_errorReTypePass.setIcon(new ImageIcon(getClass().getResource("/Drawable/ok.jpg")));
          ALL_CORRECT_INPUT = true;
      }
      else{
          ALL_CORRECT_INPUT=false;
          jLabel_errorReTypePass.setIcon(null);
          jLabel_errorReTypePass.setText("Not Matched");
      }
      

    }//GEN-LAST:event_jPasswordField_reTypeNewPassKeyTyped

    String holdPassword;
    private void jTextField_userNameFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTextField_userNameFocusGained
       if(jTextField_userName.getText().equals("")){
         StudentDAO stddao = new StudentDAO();
        Student student = new Student();
        student.setStudentId(StudentDAO.CURRENT_STUDENT);
        student = stddao.getAllStudentRecord(student);
        jTextField_userName.setText(student.getUserName());
        holdPassword = student.getPassword();
       }
    }//GEN-LAST:event_jTextField_userNameFocusGained

    private void jPasswordField_currentPassFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jPasswordField_currentPassFocusLost
        String pass  = new String(jPasswordField_currentPass.getPassword());
        if(!pass.equals("")){
              if(pass.equals(holdPassword)){
                  jLabel_errorCurrentPass.setText("");
                  jLabel_errorCurrentPass.setIcon(new ImageIcon(getClass().getResource("/Drawable/ok.jpg")));
                  ALL_CORRECT_INPUT = true;
              }
              else{//when the given current password didn't matched;
                  ALL_CORRECT_INPUT=false;
                  jLabel_errorCurrentPass.setIcon(null);
                  jLabel_errorCurrentPass.setText("Not Matched..!!!");
              }
          }
    }//GEN-LAST:event_jPasswordField_currentPassFocusLost

    private void jButton_updatePasswordActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_updatePasswordActionPerformed
        //firstlly check if all the inputs are correct ;
        if(ALL_CORRECT_INPUT){
            String userName = jTextField_userName.getText();
            String password = new String(jPasswordField_newPass.getPassword());
            Student student = new Student();
            student.setUserName(userName);
            student.setPassword(password);
            student.setStudentId(StudentDAO.CURRENT_STUDENT);
            
            //now the controller method to update the user name and password are calle
            StudentDAO stddao = new StudentDAO();
            boolean success = stddao.studentUpdateUsernamePassword(student);
            if(success){
                JOptionPane.showMessageDialog(null,"Successfully Updated your record\n"
                        + "----------------------------------------------------------\n"
                        + "New User-Name is: "+student.getUserName()
                        + "\nNew Password is :"+student.getPassword());
            }
            else{
                JOptionPane.showMessageDialog(null,"Can't update your Record Contact your librarian\n\tThank You ...!!!");
            }
        }
        else{
            JOptionPane.showMessageDialog(null,"You haven't provide us some Data yet"+StudentDAO.CURRENT_STUDENT_NAME);
        }
        
    }//GEN-LAST:event_jButton_updatePasswordActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton_updatePassword;
    private javax.swing.JLabel jLabel_currentPass;
    private javax.swing.JLabel jLabel_errorCurrentPass;
    private javax.swing.JLabel jLabel_errorNewPass;
    private javax.swing.JLabel jLabel_errorReTypePass;
    private javax.swing.JLabel jLabel_errorUsername;
    private javax.swing.JLabel jLabel_newPass;
    private javax.swing.JLabel jLabel_reTypeNewPass;
    private javax.swing.JLabel jLabel_title;
    private javax.swing.JLabel jLabel_userName;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPasswordField jPasswordField_currentPass;
    private javax.swing.JPasswordField jPasswordField_newPass;
    private javax.swing.JPasswordField jPasswordField_reTypeNewPass;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JTextField jTextField_userName;
    // End of variables declaration//GEN-END:variables
}
